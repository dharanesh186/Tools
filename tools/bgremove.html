<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>ðŸ§½ Background Remover | Universal Remover</title>
  <style>
    :root { --nebula-purple: #6e45e2; --star-white: #f8f9fa; }
    body { 
      font-family: 'Segoe UI', sans-serif; max-width: 900px; margin: auto; padding: 40px 20px; 
      background: radial-gradient(circle at center, #1b2735 0%, #090a0f 100%);
      color: var(--star-white); min-height: 100vh;
    }
    .section-card {
      background: rgba(255, 255, 255, 0.05); padding: 25px; border-radius: 16px;
      border: 1px solid rgba(255, 255, 255, 0.1); backdrop-filter: blur(10px); text-align: center;
    }
    canvas {
      max-width: 100%; height: auto; margin-top: 20px; border: 2px solid #444;
      cursor: crosshair;
      /* This grid shows you what is transparent */
      background-color: #fff;
      background-image: linear-gradient(45deg, #ccc 25%, transparent 25%), linear-gradient(-45deg, #ccc 25%, transparent 25%), linear-gradient(45deg, transparent 75%, #ccc 75%), linear-gradient(-45deg, transparent 75%, #ccc 75%);
      background-size: 20px 20px;
      background-position: 0 0, 0 10px, 10px -10px, -10px 0px;
    }
    .tools { display: flex; gap: 10px; justify-content: center; margin: 20px 0; }
    button { padding: 10px 20px; cursor: pointer; background: var(--nebula-purple); color: white; border: none; border-radius: 5px; font-weight: bold; }
    .active-tool { outline: 3px solid #00f2ff; }
  </style>
</head>
<body>

<h1> ðŸ§½ Background Remover</h1>
<div class="section-card">
  <input type="file" id="upload" accept="image/*" style="margin-bottom:20px;">
  
  <div class="tools">
    <button id="magicBtn" class="active-tool" onclick="setTool('magic')">ðŸª„ Auto-Remove (Click Color)</button>
    <button id="eraseBtn" onclick="setTool('erase')">ðŸ§½ Manual Eraser</button>
  </div>

  <label>Sensitivity: <input type="range" id="threshold" min="0" max="150" value="50"></label>
  
  <br>
  <canvas id="canvas"></canvas>
  <br>
  <button onclick="downloadImg()" style="margin-top:20px; background:#28a745;">ðŸ’¾ Download PNG</button>
</div>

<script>
  const canvas = document.getElementById('canvas');
  const ctx = canvas.getContext('2d');
  let currentTool = 'magic';
  let isDrawing = false;
  let imgLoaded = false;

  function setTool(tool) {
    currentTool = tool;
    document.getElementById('magicBtn').classList.toggle('active-tool', tool === 'magic');
    document.getElementById('eraseBtn').classList.toggle('active-tool', tool === 'erase');
  }

  document.getElementById('upload').addEventListener('change', function(e) {
    const reader = new FileReader();
    reader.onload = function(event) {
      const img = new Image();
      img.onload = function() {
        canvas.width = img.width;
        canvas.height = img.height;
        ctx.drawImage(img, 0, 0);
        imgLoaded = true;
      }
      img.src = event.target.result;
    }
    reader.readAsDataURL(e.target.files[0]);
  });

  canvas.addEventListener('mousedown', startAction);
  canvas.addEventListener('mousemove', draw);
  canvas.addEventListener('mouseup', () => isDrawing = false);

  function startAction(e) {
    if (!imgLoaded) return;
    const {x, y} = getMousePos(e);

    if (currentTool === 'magic') {
      const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
      const pixels = imageData.data;
      const index = (y * canvas.width + x) * 4;
      const targetR = pixels[index];
      const targetG = pixels[index+1];
      const targetB = pixels[index+2];
      const threshold = document.getElementById('threshold').value;

      for (let i = 0; i < pixels.length; i += 4) {
        const r = pixels[i], g = pixels[i+1], b = pixels[i+2];
        const distance = Math.sqrt((r-targetR)**2 + (g-targetG)**2 + (b-targetB)**2);
        if (distance < threshold) pixels[i+3] = 0;
      }
      ctx.putImageData(imageData, 0, 0);
    } else {
      isDrawing = true;
      erase(e);
    }
  }

  function draw(e) { if (isDrawing && currentTool === 'erase') erase(e); }

  function erase(e) {
    const {x, y} = getMousePos(e);
    ctx.globalCompositeOperation = 'destination-out';
    ctx.beginPath();
    ctx.arc(x, y, 20, 0, Math.PI * 2);
    ctx.fill();
  }

  function getMousePos(e) {
    const rect = canvas.getBoundingClientRect();
    return {
      x: Math.round((e.clientX - rect.left) * (canvas.width / rect.width)),
      y: Math.round((e.clientY - rect.top) * (canvas.height / rect.height))
    };
  }

  function downloadImg() {
    const link = document.createElement('a');
    link.download = 'transparent_nebula.png';
    link.href = canvas.toDataURL('image/png');
    link.click();
  }
</script>
</body>
</html>
